<div class="feedback-container">
  <h1 class="page-head">Feedback/Query</h1>

  <form [formGroup]="feedbackForm" class="feedback-form" (ngSubmit)="submitFeedback()">
    <div class="form-row">
      <div class="form-field">
        <app-ilogi-input formControlName="user_name" fieldLabel="Full Name" [mandatory]="true" [type]="'text'"
          placeholder="Enter your full name"
          [errorMessages]="{ required: 'Name is required', maxlength: 'Maximum 255 characters allowed' }">
        </app-ilogi-input>
      </div>
    </div>

    <div class="form-row">
      <div class="form-field">
        <app-ilogi-input formControlName="email" fieldLabel="Email Address" [mandatory]="true" [type]="'email'"
          placeholder="Enter your email address" [errorMessages]="{
            required: 'Email is required',
            email: 'Please enter a valid email address',
            maxlength: 'Maximum 255 characters allowed'
          }">
        </app-ilogi-input>
      </div>
    </div>

    <div class="form-row">
      <div class="form-field">
        <app-ilogi-select formControlName="department_id" fieldLabel="Department" [mandatory]="true"
          [selectOptions]="departments" placeholder="Select Department">
        </app-ilogi-select>
      </div>
    </div>

    <div class="form-row">
      <div class="form-field">
        <label class="form-label">
          Satisfaction Level &nbsp;<span class="mandatory"> *</span>
        </label>
        <div class="star-rating-container">
          <div class="stars" (mouseleave)="hoveredIndex = null">
            <span *ngFor="let option of satisfactionOptions; let i = index" class="star"
              [class.selected]="option.id <= feedbackForm.get('satisfaction')?.value"
              [class.hovered]="hoveredIndex === i" (mouseenter)="hoveredIndex = i" (click)="setRating(option.id)">
              â˜…
            </span>
          </div>
          <div class="rating-label">
            {{
            feedbackForm.get('satisfaction')?.value === 5 ? 'Very Satisfied' :
            feedbackForm.get('satisfaction')?.value === 4 ? 'Satisfied' :
            feedbackForm.get('satisfaction')?.value === 3 ? 'Neutral' :
            feedbackForm.get('satisfaction')?.value === 2 ? 'Dissatisfied' :
            feedbackForm.get('satisfaction')?.value === 1 ? 'Very Dissatisfied' :
            'Tap a star to rate'
            }}
          </div>
        </div>
        <div *ngIf="f['satisfaction'].touched && f['satisfaction'].invalid" class="error-message">
          Satisfaction level is required.
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="form-field">
        <app-ilogi-input formControlName="feedback" fieldLabel="Feedback" [mandatory]="true" [type]="'textarea'"
          placeholder="Please share your feedback about our service"
          [errorMessages]="{ required: 'Feedback is required', maxlength: 'Maximum 1000 characters allowed' }">
        </app-ilogi-input>
      </div>
    </div>

    <div class="form-row">
      <div class="form-field">
        <app-ilogi-input formControlName="suggestions" fieldLabel="Suggestions" [mandatory]="false" [type]="'textarea'"
          placeholder="Any suggestions for improvement? (Optional)"
          [errorMessages]="{ maxlength: 'Maximum 1000 characters allowed' }">
        </app-ilogi-input>
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary" [disabled]="feedbackForm.invalid || isSubmitting">
        {{ isSubmitting ? 'Submitting...' : 'Submit Feedback' }}
      </button>
    </div>
  </form>

  <div class="reviews-section" *ngIf="feedbackList.length > 0">
    <h2 class="reviews-title">User Reviews</h2>
    <div class="reviews-table">
      <div class="table-header">
        <div class="header-cell">Department Name</div>
        <div class="header-cell">Rating</div>
        <div class="header-cell">Reviews</div>
      </div>
      <div class="table-body">
        <div class="table-row" *ngFor="let item of paginatedFeedbackList">
          <div class="cell">{{ item.department_name }}</div>
          <div class="cell">
            {{ item.avg_rating }}/5 ({{ item.ratings_count }} rating{{ item.ratings_count !== 1 ? 's' : '' }})
          </div>
          <div class="cell">
            <button class="read-reviews-btn" (click)="goToDetails(item.department_id)">Reviews</button>
          </div>
        </div>
      </div>
    </div>

    <div class="pagination" *ngIf="totalPages > 1">
      <button class="pagination-btn" (click)="prevPage()" [disabled]="currentPage === 1">
        &laquo; Prev
      </button>

      <button *ngFor="let page of pages" class="pagination-btn" [class.active]="page === currentPage"
        (click)="goToPage(page)">
        {{ page }}
      </button>

      <button class="pagination-btn" (click)="nextPage()" [disabled]="currentPage === totalPages">
        Next &raquo;
      </button>
    </div>
  </div>

</div>