<!-- forgot-password.component.html -->
<div class="page-wrapper">
  <!-- Background video (same as login) -->
  <video autoplay muted loop playsinline class="bg-video" aria-hidden="true">
    <source src="assets/videos/tripura-tourism-video.mp4" type="video/mp4" />
    Your browser does not support the video tag.
  </video>

  <div class="bg-overlay" aria-hidden="true"></div>

  <div class="center-stage" role="main" aria-label="Forgot password area">
    <div class="auth-card" role="region" aria-labelledby="forgotTitle">
      <div class="card-inner">
        <div class="logo-top" aria-hidden="true">
          <a class="logo-link" aria-label="Go to home">
            <img src="assets/logo/tripuratourismlogo.png" alt="Swaagat logo" class="signupLogo" />
          </a>
        </div>

        <header class="card-header">
          <h2 id="forgotTitle" class="title"><strong>Forgot Password</strong></h2>
          <p class="subtitle">Enter registered mobile to receive an OTP.</p>
        </header>

        <form [formGroup]="form" (ngSubmit)="onPrimaryClick()" class="form" novalidate>
          <!-- STEP: enter identifier -->
          <section class="form-step" [class.hidden]="step !== 'enter'">
            <div class="input-wrap">
              <app-ilogi-input
                fieldId="identifier"
                fieldLabel="Registered Mobile"
                [mandatory]="true"
                formControlName="identifier"
                type="text"
                placeholder="Enter 10-digit mobile number">
              </app-ilogi-input>
              <small class="error-text" *ngIf="identifierControl?.touched && identifierControl?.invalid">
                {{ getIdentifierErrorMessage() }}
              </small>
            </div>
          </section>

          <!-- STEP: verify OTP -->
          <section class="form-step" [class.hidden]="step !== 'verify'">
            <p class="muted small"><strong>{{ infoMessage }}</strong></p>

            <div class="input-wrap">
              <app-ilogi-input
                fieldId="otp"
                fieldLabel="Enter OTP"
                [mandatory]="true"
                formControlName="otp"
                type="text"
                placeholder="Enter the OTP">
              </app-ilogi-input>
              <small class="error-text" *ngIf="form.get('otp')?.touched && form.get('otp')?.invalid">
                Enter the {{ otpLength }}-digit OTP.
              </small>
            </div>

            <div class="otp-row">
              <div class="timer small" *ngIf="otpTimerSeconds > 0">Retry in <span class="countdown">{{ otpTimerDisplay }}</span></div>

              <button type="button"
                      class="resend-btn"
                      [class.disabled]="!isResendEnabled"
                      [disabled]="!isResendEnabled"
                      (click)="resendOtp()"
                      aria-disabled="{{ !isResendEnabled }}">
                {{ isResendEnabled ? 'Resend OTP' : 'Resend (disabled)' }}
              </button>
            </div>
          </section>

          <!-- STEP: reset password -->
          <section class="form-step" [class.hidden]="step !== 'reset'">
            <p class="muted small success-message" *ngIf="step === 'reset'">{{ infoMessage }}</p>

            <div class="input-wrap">
              <app-ilogi-input
                fieldId="newPassword"
                fieldLabel="New Password"
                [mandatory]="true"
                formControlName="newPassword"
                type="password"
                placeholder="Minimum 6 characters">
              </app-ilogi-input>

              <small class="error-text"
                     *ngIf="form.get('newPassword')?.touched && form.get('newPassword')?.hasError('required')">
                New password is required.
              </small>
              <small class="error-text" *ngIf="form.get('newPassword')?.hasError('minlength')">
                Password must be at least 6 characters long.
              </small>
              <small class="error-text" *ngIf="form.get('newPassword')?.hasError('pattern')">
                Password must contain uppercase, lowercase, and a special character.
              </small>
            </div>

            <div class="input-wrap">
              <app-ilogi-input fieldId="confirmPassword"
                               fieldLabel="Confirm Password"
                               [mandatory]="true"
                               formControlName="confirmPassword"
                               type="password"
                               placeholder="Confirm new password">
              </app-ilogi-input>
              <small class="error-text"
                     *ngIf="form.get('confirmPassword')?.touched && form.get('confirmPassword')?.invalid">
                Please confirm your password.
              </small>
            </div>
          </section>

          <!-- CAPTCHA (optional - kept if you have it elsewhere) -->
          <div class="captcha-row" *ngIf="false">
            <!-- placeholder to keep structure if needed later -->
            <canvas #captchaCanvas width="160" height="56" class="captcha-canvas" aria-hidden="true"></canvas>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn-submit" [disabled]="isLoading" aria-busy="{{isLoading}}">
              <span *ngIf="!isLoading" class="btn-text">{{ primaryLabel }}</span>
              <span *ngIf="isLoading" class="btn-spinner" aria-hidden="true"></span>
            </button>

            <a class="text-center small link-back" (click)="backToLogin()" role="link" tabindex="0">Back to Login</a>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Password reset popup (keeps parity with your login component) -->
  <!-- <div class="popup-overlay" >
    <div class="popup-content" role="dialog" aria-modal="true" aria-labelledby="popupTitle">
      <div class="success-icon">âœ“</div>
      <h4 id="popupTitle" class="popup-title">Password reset required</h4>
      <div class="popup-details">
        <h5>Please reset your password to continue.</h5>
      </div>
      <button class="btn popup-btn">Reset</button>
    </div>
  </div> -->
</div>
