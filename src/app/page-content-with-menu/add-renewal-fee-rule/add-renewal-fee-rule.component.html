<div style="margin-left: 113px !important;" class="renewal-container">
  <div class="dialog-header">
    <h4>
      <b>{{ data.mode === 'add' ? 'Add Renewal Fee Rule' : 'Edit Renewal Fee Rule' }}</b>
    </h4>
    <button mat-icon-button (click)="close()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <form [formGroup]="feeRuleForm" (ngSubmit)="saveFeeRule()">

    <div style="display: flex; flex-direction: row; justify-content: center; align-items: center; gap: 20px !important;"
      class="form-row">
      <mat-form-field appearance="outline">
        <mat-label>Renewal Cycle</mat-label>
        <mat-select formControlName="renewal_cycle_id">
          <mat-option *ngFor="let c of renewalCycles" [value]="c.id">
            {{ c.renewal_title }}
          </mat-option>
          <mat-option *ngIf="!renewalCycles.length" [value]="null" disabled>
            No more renewal cycles found. Please add a renewal cycle first.
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Fee Type</mat-label>
        <mat-select formControlName="fee_type">
          <mat-option value="calculated">Calculated</mat-option>
          <mat-option value="hardcoded">HardCoded</mat-option>
          <mat-option value="estimated">Estimated</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Question</mat-label>
        <mat-select formControlName="question_id">
          <mat-option *ngFor="let q of serviceQuestions" [value]="q.id">
            {{ q.question_label || q.title || q.label || q.id }}
          </mat-option>
          <mat-option *ngIf="!data.service?.questions?.length" [value]="null" disabled>
            No more questions found. Please add a question first.
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div style="display: flex; flex-direction: row; justify-content: center; align-items: center; gap: 20px !important;"
      class="form-row">
      <mat-form-field appearance="outline">
        <mat-label>Operator</mat-label>
        <mat-select formControlName="condition_operator">
          <mat-option value="<">&lt;</mat-option>
          <mat-option value="<=">&lt;=</mat-option>
          <mat-option value=">">&gt;</mat-option>
          <mat-option value=">=">&gt;=</mat-option>
          <mat-option value="between">between</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Value Start</mat-label>
        <input matInput formControlName="condition_value_start" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Value End</mat-label>
        <input matInput formControlName="condition_value_end" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Fixed Fee</mat-label>
        <input matInput type="number" formControlName="fixed_fee" />
      </mat-form-field>
    </div>

    <div style="display: flex; flex-direction: row; justify-content: center; align-items: center; gap: 20px !important;"
      class="form-row">
      <mat-form-field appearance="outline">
        <mat-label>Fixed Calculated Fee</mat-label>
        <input matInput type="number" formControlName="fixed_calculated_fee" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Per Unit Fee</mat-label>
        <input matInput type="number" formControlName="per_unit_fee" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Priority</mat-label>
        <input matInput type="number" formControlName="priority" min="1" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Status</mat-label>
        <mat-select formControlName="status">
          <mat-option [value]="1">Active</mat-option>
          <mat-option [value]="0">Inactive</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div style="display: flex; flex-direction: row; justify-content: center; align-items: center; gap: 20px !important;"
      class="form-actions">
      <button mat-raised-button color="warn" type="button" (click)="close()">Cancel</button>
      <button mat-raised-button color="primary" class="submit-btn" type="submit"
        [disabled]="isSubmitting">
        {{ isSubmitting ? 'Saving...' : (data.mode === 'add' ? 'Save Renewal Fee Rule' : 'Update Renewal Fee Rule') }}
      </button>
    </div>

  </form>
</div>