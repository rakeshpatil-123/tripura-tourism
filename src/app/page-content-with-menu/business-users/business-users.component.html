<div class="business-users-wrapper">
  <h2 class="title">
    <i class="pi pi-briefcase title-icon"></i>
    Business Users
  </h2>
  <div class="action-bar">
    <div class="search-box" role="search" aria-label="Search business users">
      <input pInputText type="text" placeholder="Search by Name, PAN, Email or Mobile..." [(ngModel)]="searchText"
        (keydown.enter)="onServerSearch()" class="server-search-input" aria-label="Search by Name, PAN, Email or Mobile" />

      <button pButton type="button" class="btn btn-search" (click)="onServerSearch()" aria-label="Search">
        <i class="pi pi-search"></i>
        <span class="btn-text">Search</span>
      </button>

      <button pButton type="button" class="btn btn-clear" (click)="clearSearch()" aria-label="Clear search">
        <i class="pi pi-times"></i>
        <span class="btn-text">Clear</span>
      </button>
    </div>

    <div class="download-box">
      <button pButton type="button" class="download-btn" (click)="confirmDownload()" aria-label="Download Excel">
        <i class="pi pi-download"></i>
        <span class="btn-text">Download Excel</span>
      </button>
    </div>
  </div>

  <div class="p-4 fade-in">
    <p-table #dt [value]="users" [paginator]="true" [rows]="rows" [rowsPerPageOptions]="[5, 10, 20]" [loading]="loading"
      [responsiveLayout]="'scroll'" [globalFilterFields]="globalFilterFields" [lazy]="true"
      [totalRecords]="totalRecords" (onLazyLoad)="onLazyLoad($event)"
      class="p-datatable-gridlines p-mb-4 animated-table">
      <ng-template pTemplate="header">
        <tr class="header-bg-color">
          <th>No.</th>
          <th *ngFor="let col of columns" [ngClass]="{
              'col-ward': col.field === 'ward',
              'col-ulb': col.field === 'ulb',
              'col-address': col.field === 'address',
              'col-normal': col.field !== 'ward' && col.field !== 'ulb' && col.field !== 'address'
            }" pSortableColumn="{{ col.field }}">
            <div class="header-wrapper">
              {{ col.header }}
              <p-sortIcon [field]="col.field"></p-sortIcon>
            </div>
          </th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-user let-rowIndex="rowIndex">
        <tr class="table-row-animate">
          <td>{{ rowIndex + 1 }}</td>
          <td *ngFor="let col of columns; let rowIndex = index" [ngClass]="{
              'col-ward nowrap': col.field === 'ward',
              'col-ulb nowrap': col.field === 'ulb',
              'col-address wrap': col.field === 'address',
              'col-normal nowrap': col.field !== 'ward' && col.field !== 'ulb' && col.field !== 'address'
            }" pTooltip="{{ user[col.field] }}" tooltipPosition="top">
            <span *ngIf="col.field !== 'status' && col.field !== 'login'">
              {{ user[col.field] || '----' }}
            </span>
            <span *ngIf="col.field === 'status'">
              <form [formGroup]="userForms[user.id]">
                <p-toggleswitch formControlName="status" (onChange)="confirmStatusChange(user)">
                </p-toggleswitch>
              </form>
            </span>
            <span *ngIf="col.field === 'login'">
                <button pButton pRipple type="button" icon="pi pi-pencil" class="p-button-rounded p-button-sm edit-btn"
            pTooltip="Login as User" tooltipPosition="left" (click)="getUserLogin(user)">Login as User
                </button>
            </span>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td [attr.colspan]="columns.length" class="no-data-cell">
            <div class="no-data-wrapper">
              <i class="pi pi-inbox no-data-icon"></i>
              <h3>No Business Users Found</h3>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>