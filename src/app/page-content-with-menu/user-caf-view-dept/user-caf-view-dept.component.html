<!-- user-caf-view-dept.component.html -->
<div class="container py-4">
  <h2 class="mb-4">User CAF Details </h2>

  <div *ngIf="isLoading" class="alert alert-info">
    Loading user data...
  </div>

  <div *ngIf="error" class="alert alert-danger">
    {{ error }}
  </div>

  <mat-tab-group
    *ngIf="!isLoading"
    (selectedIndexChange)="onTabChange($event)"
    [selectedIndex]="selectedIndex"
    mat-stretch-tabs="false"
    dynamicHeight="true">
    <!-- Unit Details -->
    <mat-tab label="Unit Details">
       <ng-container *ngIf="selectedIndex === 0 && !fetchedTabs.unitDetails">
        <mat-card>
          <mat-card-content class="text-center py-4">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-2 mb-0">Loading unit details...</p>
          </mat-card-content>
        </mat-card>
      </ng-container>
      <mat-card *ngIf="fetchedTabs.unitDetails && unitDetails; else unitNoData">
        <mat-card-header>
          <mat-card-title>Unit Information</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="row">
            <div class="col-md-6">
              <p><strong>Unit Name:</strong> {{ safeDisplay(unitDetails.unit_name) }}</p>
              <p><strong>Address:</strong> {{ safeDisplay(unitDetails.unit_address) }}</p>
              <p><strong>PIN:</strong> {{ safeDisplay(unitDetails.pin_no) }}</p>
              <p><strong>Post Office:</strong> {{ safeDisplay(unitDetails.post_office) }}</p>
              <p><strong>Contact No:</strong> {{ safeDisplay(unitDetails.contact_no) }}</p>
              <p><strong>Email:</strong> {{ safeDisplay(unitDetails.email) }}</p>
              <p><strong>Website:</strong> {{ safeDisplay(unitDetails.website) }}</p>
            </div>
            <div class="col-md-6">
              <p><strong>District:</strong> {{ safeDisplay(unitDetails.unit_location_district) }}</p>
              <p><strong>Subdivision:</strong> {{ safeDisplay(unitDetails.unit_location_subdivision) }}</p>
              <p><strong>Police Station:</strong> {{ safeDisplay(unitDetails.unit_location_police_station) }}</p>
              <p><strong>Land Type:</strong> {{ safeDisplay(unitDetails.unit_location_land_type) }}</p>
              <p><strong>Area Type:</strong> {{ safeDisplay(unitDetails.unit_location_area_type) }}</p>
              <p><strong>Estate Name:</strong> {{ safeDisplay(unitDetails.unit_location_estate_name) }}</p>
              <p><strong>Plot No:</strong> {{ safeDisplay(unitDetails.unit_location_plot_no) }}</p>
            </div>
          </div>

          <hr>
          <h5>Land Record Details</h5>
          <div class="row">
            <div class="col-md-6">
              <p><strong>Revenue Circle:</strong> {{ safeDisplay(unitDetails.land_record_details_revenue_circle) }}</p>
              <p><strong>Tehasil:</strong> {{ safeDisplay(unitDetails.land_record_details_tehasil) }}</p>
              <p><strong>Mouza:</strong> {{ safeDisplay(unitDetails.land_record_details_revenue_mouza) }}</p>
              <p><strong>Khatian No:</strong> {{ safeDisplay(unitDetails.land_record_details_khatian_number_new) }}</p>
            </div>
            <div class="col-md-6">
              <p><strong>CS Plot No:</strong> {{ safeDisplay(unitDetails.land_record_details_plot_number_cs_sabek) }}
              </p>
              <p><strong>RS Plot No:</strong> {{ safeDisplay(unitDetails.land_record_details_plot_number_rs_hal) }}</p>
              <p><strong>Land Classification:</strong> {{
                safeDisplay(unitDetails.land_record_details_classification_of_land) }}</p>
              <p><strong>Land Area:</strong> {{ safeDisplay(unitDetails.land_record_details_land_area) }} {{
                safeDisplay(unitDetails.land_record_details_unit) }}</p>
            </div>
          </div>

          <hr>
          <h5>Construction Details</h5>
          <div class="row">
            <div class="col-md-4">
              <p><strong>Load Bearing (sq mtr):</strong> {{
                safeDisplay(unitDetails.construction_details_load_bearing_in_sq_mtr) }}</p>
              <p><strong>RCC Building (sq mtr):</strong> {{
                safeDisplay(unitDetails.construction_details_rcc_building_in_sq_mtr) }}</p>
              <p><strong>Others:</strong> {{ safeDisplay(unitDetails.construction_details_others_construction) }}</p>
            </div>
            <div class="col-md-4">
              <p><strong>Sanitary Latrine Count:</strong> {{
                safeDisplay(unitDetails.construction_details_sanitary_latrine_count) }}</p>
              <p><strong>Boundary Wall (mtr):</strong> {{
                safeDisplay(unitDetails.construction_details_boundary_wall_in_mtr) }}</p>
              <p><strong>Power Supply Agency:</strong> {{
                safeDisplay(unitDetails.construction_details_power_supply_agency_at_the_factory) }}</p>
            </div>
          </div>

          <hr>
          <h5>Investment & Employment</h5>
          <div class="row">
            <div class="col-md-6">
              <p><strong>Land Value:</strong> {{
                formatCurrency(unitDetails.investment_details_value_of_land_as_per_sale_deed) }}</p>
              <p><strong>Building Value:</strong> {{ formatCurrency(unitDetails.investment_details_value_of_building) }}
              </p>
              <p><strong>Plant/Machinery Value:</strong> {{
                formatCurrency(unitDetails.investment_details_value_of_plant_machinery_or_service_equipment) }}</p>
              <p><strong>Total Project Cost:</strong> {{
                formatCurrency(unitDetails.investment_details_total_project_cost) }}</p>
            </div>
            <div class="col-md-6">
              <p><strong>Men Workers:</strong> {{ safeDisplay(unitDetails.employment_details_worker_men_count) }}</p>
              <p><strong>Women Workers:</strong> {{ safeDisplay(unitDetails.employment_details_worker_women_count) }}
              </p>
              <p><strong>Management Staff:</strong> {{
                safeDisplay(unitDetails.employment_details_management_staff_count) }}</p>
              <p><strong>Others:</strong> {{ safeDisplay(unitDetails.employment_details_others_count) }}</p>
              <p><strong>Total Employment:</strong> {{ safeDisplay(unitDetails.employment_details_total_employment) }}
              </p>
            </div>
          </div>

          <hr>
          <h5>Other</h5>
          <p><strong>Annual Turnover:</strong> {{ formatCurrency(unitDetails.annual_turnover) }}</p>
          <p><strong>Enterprise Category:</strong> {{ safeDisplay(unitDetails.category_of_enterprise) }}</p>
          <p><strong>Working Session:</strong> {{ safeDisplay(unitDetails.working_session) }}</p>
          <p><strong>Manufacturing Process:</strong> {{ safeDisplay(unitDetails.product_manufacturing_process) }}</p>
        </mat-card-content>
      </mat-card>
      <ng-template #unitNoData>
        <mat-card>
          <mat-card-content class="text-center py-4">
            <p class="text-muted">No unit details found.</p>
          </mat-card-content>
        </mat-card>
      </ng-template>
    </mat-tab>

    <!-- Enterprise Details -->
    <mat-tab label="Enterprise Details">
      <ng-container *ngIf="selectedIndex === 1 && !fetchedTabs.enterpriseDetails">
        <mat-card>
          <mat-card-content class="text-center py-4">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-2 mb-0">Loading enterprise details...</p>
          </mat-card-content>
        </mat-card>
      </ng-container>

      <mat-card *ngIf="fetchedTabs.enterpriseDetails && enterpriseDetails; else enterpriseNoData">
        <mat-card-header>
          <mat-card-title>Enterprise Information</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="row">
            <div class="col-md-6 ">
              <p><strong>Constitution:</strong> {{ safeDisplay(enterpriseDetails.constitution_of_enterprise) }}</p>
              <p><strong>Enterprise Name:</strong> {{ safeDisplay(enterpriseDetails.enterprise_name) }}</p>
              <p><strong>PAN No:</strong> {{ safeDisplay(enterpriseDetails.business_pan_no) }}</p>
              <p><strong>Address:</strong> {{ safeDisplay(enterpriseDetails.enterprise_address) }}</p>
              <p><strong>Registered Address:</strong> {{ safeDisplay(enterpriseDetails.enterprises_registered_address)
                }}</p>
              <p><strong>Habitation Area:</strong> {{ safeDisplay(enterpriseDetails.habitation_area_building) }}</p>
              <p><strong>PIN:</strong> {{ safeDisplay(enterpriseDetails.pin) }}</p>
              <p><strong>Post Office:</strong> {{ safeDisplay(enterpriseDetails.post_office) }}</p>
              <p><strong>Police Station:</strong> {{ safeDisplay(enterpriseDetails.police_station) }}</p>
            </div>
            <div class="col-md-6">
              <p><strong>Authorized Rep Name:</strong> {{ safeDisplay(enterpriseDetails.authorized_representative_name)
                }}</p>
              <p><strong>Designation:</strong> {{ safeDisplay(enterpriseDetails.authorized_representative_designation)
                }}</p>
              <p><strong>Aadhar No:</strong> {{ safeDisplay(enterpriseDetails.authorized_representative_aadhar_no) }}
              </p>
              <p><strong>Mobile:</strong> {{ safeDisplay(enterpriseDetails.authorized_representative_mobile_no) }}</p>
              <p><strong>Email:</strong> {{ safeDisplay(enterpriseDetails.authorized_representative_email_id) }}</p>
              <p><strong>Alternate Mobile:</strong> {{
                safeDisplay(enterpriseDetails.authorized_representative_alternate_mobile_no) }}</p>
              <p><strong>Phone:</strong> {{ safeDisplay(enterpriseDetails.authorized_representative_phone_no) }}</p>
              <p><strong>Proposal For:</strong> {{ safeDisplay(enterpriseDetails.proposal_for) }}</p>
              <p><strong>Proposed Commissioning Date:</strong> {{
                formatDate(enterpriseDetails.proposed_date_of_commissioning) }}</p>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
      <ng-template #enterpriseNoData>
        <mat-card>
          <mat-card-content class="text-center py-4">
            <p class="text-muted">No enterprise details found.</p>
          </mat-card-content>
        </mat-card>
      </ng-template>
    </mat-tab>

    <!-- Management Details -->
    <mat-tab label="Management Details">
       <ng-container *ngIf="selectedIndex === 2 && !fetchedTabs.managementDetails">
        <mat-card>
          <mat-card-content class="text-center py-4">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-2 mb-0">Loading management details...</p>
          </mat-card-content>
        </mat-card>
      </ng-container>
      <mat-card *ngIf="fetchedTabs.managementDetails && managementDetails ; else managementNoData">
        <!-- Owner Details -->
        <mat-card class="mb-4">
          <mat-card-header>
            <mat-card-title>Owner Details</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="row">
              <div class="col-md-6">
                <p><strong>Name:</strong> {{ safeDisplay(managementDetails.management_details?.owner_details_name) }}
                </p>
                <p><strong>Father's Name:</strong> {{
                  safeDisplay(managementDetails.management_details?.owner_details_fathers_name) }}</p>
                <p><strong>Residential Address:</strong> {{
                  safeDisplay(managementDetails.management_details?.owner_details_residential_address) }}</p>
                <p><strong>Police Station:</strong> {{
                  safeDisplay(managementDetails.management_details?.owner_details_police_station) }}</p>
                <p><strong>PIN:</strong> {{ safeDisplay(managementDetails.management_details?.owner_details_pin) }}</p>
                <p><strong>Mobile:</strong> {{ safeDisplay(managementDetails.management_details?.owner_details_mobile)
                  }}</p>
                <p><strong>Alternate Mobile:</strong> {{
                  safeDisplay(managementDetails.management_details?.owner_details_alternate_mobile) }}</p>
                <p><strong>Aadhar No:</strong> {{ safeDisplay(managementDetails.management_details?.owner_aadhar_no) }}
                </p>
                <p><strong>Status:</strong> {{ safeDisplay(managementDetails.management_details?.owner_details_status)
                  }}</p>
                <p><strong>Email:</strong> {{ safeDisplay(managementDetails.management_details?.owner_details_email) }}
                </p>
                <p><strong>DOB:</strong> {{ formatDate(managementDetails.management_details?.owner_details_dob) }}</p>
                <p><strong>Social Status:</strong> {{
                  safeDisplay(managementDetails.management_details?.owner_details_social_status) }}</p>
                <p><strong>Differently Abled:</strong> {{
                  safeDisplay(managementDetails.management_details?.owner_details_is_differently_abled) }}</p>
                <p><strong>Women Entrepreneur:</strong> {{
                  safeDisplay(managementDetails.management_details?.owner_details_is_women_entrepreneur) }}</p>
                <p><strong>Minority:</strong> {{
                  safeDisplay(managementDetails.management_details?.owner_details_is_minority) }}</p>
              </div>
              <div class="col-md-6">
                <div *ngIf="managementDetails.management_details?.owner_details_photo" class="mb-3">
                  <strong>Owner Photo:</strong><br>
                  <img [src]="managementDetails.management_details.owner_details_photo" alt="Owner Photo"
                    class="img-fluid mt-2" style="max-height: 200px; object-fit: cover;">
                </div>
                <div *ngIf="managementDetails.management_details?.signature_authorization_of_owner" class="mb-3">
                  <strong>Owner Signature:</strong><br>
                  <img [src]="managementDetails.management_details.signature_authorization_of_owner"
                    alt="Owner Signature" class="img-fluid mt-2" style="max-height: 100px; object-fit: contain;">
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Manager Details -->
        <mat-card class="mb-4">
          <mat-card-header>
            <mat-card-title>Manager Details</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="row">
              <div class="col-md-6">
                <p><strong>Name:</strong> {{ safeDisplay(managementDetails.management_details?.manager_details_name) }}
                </p>
                <p><strong>Father's Name:</strong> {{
                  safeDisplay(managementDetails.management_details?.manager_details_fathers_name) }}</p>
                <p><strong>Residential Address:</strong> {{
                  safeDisplay(managementDetails.management_details?.manager_details_residential_address) }}</p>
                <p><strong>Police Station:</strong> {{
                  safeDisplay(managementDetails.management_details?.manager_details_police_station) }}</p>
                <p><strong>PIN:</strong> {{ safeDisplay(managementDetails.management_details?.manager_details_pin) }}
                </p>
                <p><strong>Mobile:</strong> {{ safeDisplay(managementDetails.management_details?.manager_details_mobile)
                  }}</p>
                <p><strong>Aadhar No:</strong> {{
                  safeDisplay(managementDetails.management_details?.manager_details_aadhar_no) }}</p>
                <p><strong>DOB:</strong> {{ formatDate(managementDetails.management_details?.manager_details_dob) }}</p>
              </div>
              <div class="col-md-6">
                <div *ngIf="managementDetails.management_details?.manager_details_photo" class="mb-3">
                  <strong>Manager Photo:</strong><br>
                  <img [src]="managementDetails.management_details.manager_details_photo" alt="Manager Photo"
                    class="img-fluid mt-2" style="max-height: 200px; object-fit: cover;">
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Signatures -->
        <mat-card class="mb-4">
          <mat-card-header>
            <mat-card-title>Signatures</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="row">
              <div class="col-md-4" *ngIf="managementDetails.management_details?.factory_occupiers_signature">
                <strong>Factory Occupier Signature:</strong><br>
                <img [src]="managementDetails.management_details.factory_occupiers_signature" alt="Occupier Signature"
                  class="img-fluid mt-2" style="max-height: 100px; object-fit: contain;">
              </div>
              <div class="col-md-4" *ngIf="managementDetails.management_details?.factory_managers_signature">
                <strong>Factory Manager Signature:</strong><br>
                <img [src]="managementDetails.management_details.factory_managers_signature" alt="Manager Signature"
                  class="img-fluid mt-2" style="max-height: 100px; object-fit: contain;">
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Partner Details -->
        <mat-card class="mb-4" *ngIf="managementDetails.partner_details?.length">
          <mat-card-header>
            <mat-card-title>Partner Details</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Father's Name</th>
                  <th>Age</th>
                  <th>Mobile</th>
                  <th>DOB</th>
                  <th>Joining Date</th>
                  <th>ID Proof</th>
                  <th>Signature</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let partner of managementDetails.partner_details">
                  <td>{{ safeDisplay(partner.name) }}</td>
                  <td>{{ safeDisplay(partner.fathers_name) }}</td>
                  <td>{{ safeDisplay(partner.age) }}</td>
                  <td>{{ safeDisplay(partner.mobile_no) }}</td>
                  <td>{{ formatDate(partner.date_of_birth) }}</td>
                  <td>{{ formatDate(partner.date_of_joining) }}</td>
                  <td>
                    <a *ngIf="partner.id_proof_doc" [href]="partner.id_proof_doc" target="_blank"
                      class="btn btn-sm btn-outline-primary">View</a>
                  </td>
                  <td>
                    <a *ngIf="partner.signature_image" [href]="partner.signature_image" target="_blank"
                      class="btn btn-sm btn-outline-primary">View</a>
                  </td>
                </tr>
              </tbody>
            </table>
          </mat-card-content>
        </mat-card>

        <!-- Board of Directors -->
        <mat-card class="mb-4" *ngIf="managementDetails.board_of_directors?.length">
          <mat-card-header>
            <mat-card-title>Board of Directors</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Address</th>
                  <th>Mobile</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let dir of managementDetails.board_of_directors">
                  <td>{{ safeDisplay(dir.name) }}</td>
                  <td>{{ safeDisplay(dir.permanent_address) }}</td>
                  <td>{{ safeDisplay(dir.mobile_number) }}</td>
                </tr>
              </tbody>
            </table>
          </mat-card-content>
        </mat-card>

        <!-- Chief Admin Heads -->
        <mat-card class="mb-4" *ngIf="managementDetails.chief_administrative_heads?.length">
          <mat-card-header>
            <mat-card-title>Chief Administrative Heads</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Address</th>
                  <th>Mobile</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let head of managementDetails.chief_administrative_heads">
                  <td>{{ safeDisplay(head.name) }}</td>
                  <td>{{ safeDisplay(head.permanent_address) }}</td>
                  <td>{{ safeDisplay(head.mobile_number) }}</td>
                </tr>
              </tbody>
            </table>
          </mat-card-content>
        </mat-card>
      </mat-card>
      <ng-template #managementNoData>
        <mat-card>
          <mat-card-content class="text-center py-4">
            <p class="text-muted">No management details found.</p>
          </mat-card-content>
        </mat-card>
      </ng-template>
    </mat-tab>

    <!-- Line of Activity -->
    <mat-tab label="Line of Activity">
       <ng-container *ngIf="selectedIndex === 3 && !fetchedTabs.lineOfActivityDetails">
        <mat-card>
          <mat-card-content class="text-center py-4">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-2 mb-0">Loading line of activity...</p>
          </mat-card-content>
        </mat-card>
      </ng-container>
      <mat-card *ngIf="fetchedTabs.lineOfActivityDetails && lineOfActivityDetails; else lineOfActivityNoData">
        <mat-card-header>
          <mat-card-title>Thrust Sector</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p><strong>Thrust Sector:</strong> {{ safeDisplay(lineOfActivityDetails.line_of_activity?.thrust_sector) }}
          </p>
        </mat-card-content>
      </mat-card>

      <!-- Raw Materials -->
      <mat-card *ngIf="fetchedTabs.lineOfActivityDetails && lineOfActivityDetails?.raw_material_to_be_used?.length"
        class="mt-4">
        <mat-card-header>
          <mat-card-title>Raw Materials</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Material</th>
                <th>Quantity/Month</th>
                <th>Unit</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let rm of lineOfActivityDetails.raw_material_to_be_used">
                <td>{{ safeDisplay(rm.raw_material_name) }}</td>
                <td>{{ safeDisplay(rm.raw_material_quantity_per_month) }}</td>
                <td>{{ safeDisplay(rm.raw_material_unit) }}</td>
              </tr>
            </tbody>
          </table>
        </mat-card-content>
      </mat-card>

      <!-- Products -->
      <mat-card *ngIf="fetchedTabs.lineOfActivityDetails && lineOfActivityDetails?.list_of_products?.length"
        class="mt-4">
        <mat-card-header>
          <mat-card-title>Products</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Product</th>
                <th>Capacity/Month</th>
                <th>Avg Production/Month</th>
                <th>Unit</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let p of lineOfActivityDetails.list_of_products">
                <td>{{ safeDisplay(p.product_name) }}</td>
                <td>{{ safeDisplay(p.product_production_capacity_per_month) }}</td>
                <td>{{ safeDisplay(p.product_average_production_per_month) }}</td>
                <td>{{ safeDisplay(p.unit) }}</td>
              </tr>
            </tbody>
          </table>
        </mat-card-content>
      </mat-card>
    <ng-template #lineOfActivityNoData>
        <mat-card>
          <mat-card-content class="text-center py-4">
            <p class="text-muted">No line of activity details found.</p>
          </mat-card-content>
        </mat-card>
      </ng-template>
    </mat-tab>

    <!-- General Attachments -->
    <mat-tab label="General Attachments">
      <ng-container *ngIf="selectedIndex === 4 && !fetchedTabs.generalAttachmentDetails">
        <mat-card>
          <mat-card-content class="text-center py-4">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-2 mb-0">Loading attachments...</p>
          </mat-card-content>
        </mat-card>
      </ng-container>

      <mat-card *ngIf="fetchedTabs.generalAttachmentDetails && generalAttachmentDetails; else generalAttachmentNoData">
        <mat-card-content>
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Document</th>
                <th>View</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngIf="generalAttachmentDetails.general_self_certification_form">
                <td>Self Certification Form</td>
                <td><a [href]="generalAttachmentDetails.general_self_certification_form" target="_blank"
                    class="btn btn-sm btn-outline-primary">View</a></td>
              </tr>
              <tr *ngIf="generalAttachmentDetails.self_certificate_format_3A">
                <td>Self Certificate Format 3A</td>
                <td><a [href]="generalAttachmentDetails.self_certificate_format_3A" target="_blank"
                    class="btn btn-sm btn-outline-primary">View</a></td>
              </tr>
              <tr *ngIf="generalAttachmentDetails.tree_registration_certificate">
                <td>Tree Registration Certificate</td>
                <td><a [href]="generalAttachmentDetails.tree_registration_certificate" target="_blank"
                    class="btn btn-sm btn-outline-primary">View</a></td>
              </tr>
              <tr *ngIf="generalAttachmentDetails.owner_pan_pdf">
                <td>Owner PAN</td>
                <td><a [href]="generalAttachmentDetails.owner_pan_pdf" target="_blank"
                    class="btn btn-sm btn-outline-primary">View</a></td>
              </tr>
              <tr *ngIf="generalAttachmentDetails.owner_aadhar_pdf">
                <td>Owner Aadhar</td>
                <td><a [href]="generalAttachmentDetails.owner_aadhar_pdf" target="_blank"
                    class="btn btn-sm btn-outline-primary">View</a></td>
              </tr>
              <tr *ngIf="generalAttachmentDetails.udyog_aadhar">
                <td>Udyog Aadhar</td>
                <td><a [href]="generalAttachmentDetails.udyog_aadhar" target="_blank"
                    class="btn btn-sm btn-outline-primary">View</a></td>
              </tr>
              <tr *ngIf="generalAttachmentDetails.gst_certificate_pdf">
                <td>GST Certificate</td>
                <td><a [href]="generalAttachmentDetails.gst_certificate_pdf" target="_blank"
                    class="btn btn-sm btn-outline-primary">View</a></td>
              </tr>
              <tr *ngIf="generalAttachmentDetails.combined_plan_document">
                <td>Combined Building Plan</td>
                <td><a [href]="generalAttachmentDetails.combined_plan_document" target="_blank"
                    class="btn btn-sm btn-outline-primary">View</a></td>
              </tr>
              <tr *ngIf="generalAttachmentDetails.detailed_project_report_pdf">
                <td>Detailed Project Report</td>
                <td><a [href]="generalAttachmentDetails.detailed_project_report_pdf" target="_blank"
                    class="btn btn-sm btn-outline-primary">View</a></td>
              </tr>
              <tr *ngIf="generalAttachmentDetails.other_supporting_docuement1_pdf">
                <td>Additional Document</td>
                <td><a [href]="generalAttachmentDetails.other_supporting_docuement1_pdf" target="_blank"
                    class="btn btn-sm btn-outline-primary">View</a></td>
              </tr>
            </tbody>
          </table>
        </mat-card-content>
      </mat-card>
    <ng-template #generalAttachmentNoData>
      <mat-card>
        <mat-card-content class="text-center py-4">
          <p class="text-muted">No attachments found.</p>
        </mat-card-content>
      </mat-card>
    </ng-template>
    </mat-tab>

    <!-- Bank Details -->
    <mat-tab label="Bank Details">
      <ng-container *ngIf="selectedIndex === 5 && !fetchedTabs.bankDetails">
        <mat-card>
          <mat-card-content class="text-center py-4">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-2 mb-0">Loading bank details...</p>
          </mat-card-content>
        </mat-card>
      </ng-container>

      <mat-card *ngIf="fetchedTabs.bankDetails && bankDetails; else bankNoData">
        <mat-card-content>
          <div class="row">
            <div class="col-md-6">
              <p><strong>Bank Name:</strong> {{ safeDisplay(bankDetails.bank_name) }}</p>
              <p><strong>Branch Name:</strong> {{ safeDisplay(bankDetails.branch_name) }}</p>
              <p><strong>Account Type:</strong> {{ safeDisplay(bankDetails.account_type) }}</p>
              <p><strong>Account Holder Name:</strong> {{ safeDisplay(bankDetails.account_holder_name) }}</p>
              <p><strong>Account Number:</strong> {{ safeDisplay(bankDetails.account_number) }}</p>
              <p><strong>IFSC Code:</strong> {{ safeDisplay(bankDetails.ifsc_code) }}</p>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <ng-template #bankNoData>
        <mat-card>
          <mat-card-content class="text-center py-4">
            <p class="text-muted">No bank details found.</p>
          </mat-card-content>
        </mat-card>
      </ng-template>
    </mat-tab>

    <!-- Activity Details (Placeholder) -->
    <!-- Activity Details -->
    <mat-tab label="Activity Details">
       <ng-container *ngIf="selectedIndex === 6 && !fetchedTabs.activityDetails">
        <mat-card>
          <mat-card-content class="text-center py-4">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-2 mb-0">Loading activity details...</p>
          </mat-card-content>
        </mat-card>
      </ng-container>
      <mat-card *ngIf="fetchedTabs.activityDetails && activityDetails && activityDetails.length > 0; else activityNoData"
        class="mb-4">
        <mat-card-header>
          <mat-card-title>Enterprise Activities (NIC Codes)</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Activity Type</th>
                <th>NIC 2-Digit</th>
                <th>NIC 4-Digit</th>
                <th>NIC 5-Digit</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let activity of activityDetails">
                <td>{{ safeDisplay(activity.activity_of_enterprise) }}</td>
                <td>{{ formatNicCode(activity.nic_2_digit_code) }}</td>
                <td>{{ formatNicCode(activity.nic_4_digit_code) }}</td>
                <td>{{ formatNicCode(activity.nic_5_digit_code) }}</td>
              </tr>
            </tbody>
          </table>
        </mat-card-content>
      </mat-card>

      <mat-card *ngIf="activityDetails && activityDetails.length === 0; else activityNoData">
        <mat-card-content class="text-center py-4">
          <p class="text-muted">No activity details available.</p>
        </mat-card-content>
      </mat-card>


      <ng-template #activityNoData>
        <mat-card>
          <mat-card-content class="text-center py-4">
            <p class="text-muted">No activity details found.</p>
          </mat-card-content>
        </mat-card>
      </ng-template>
    </mat-tab>
  </mat-tab-group>

  <div *ngIf="!isLoading && noDataForUser" class="mb-4">
    <mat-card>
      <mat-card-content class="text-center py-4">
        <h5 class="mb-2">No data available for this user.</h5>
        <p class="text-muted">All sections returned empty or no information is available for the selected user.</p>
      </mat-card-content>
    </mat-card>
  </div>

  <div *ngIf="error" class="text-center py-4">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">No data found</span>
    </div>
  </div>
</div>