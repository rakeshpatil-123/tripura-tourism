<p-card class="page-card">
  <div class="toolbar-row">
    <div class="toolbar-left">
      <h2 class="page-title">Incentive Schemes</h2>
      <p class="subtitle">Create schemes, attach proformas and dynamic forms.</p>
    </div>
    <div class="toolbar-right">
      <button pButton type="button" label="Add New Scheme" icon="pi pi-plus"
        (click)="showAddSchemeDialog = true"></button>
    </div>
  </div>

  <app-dynamic-table [data]="workflowData" [columns]="schemeColumns" [showPagination]="true" [pageSize]="5"
    [searchable]="true" (rowAction)="onRowAction($event)">
  </app-dynamic-table>
</p-card>
<p-dialog header="Add New Scheme" [(visible)]="showAddSchemeDialog" [modal]="true"
  [style]="{ width: '720px', maxWidth: '95vw', minHeight: '520px', height: 'auto' }" [draggable]="false"
  [resizable]="false" [closable]="true" [dismissableMask]="true" styleClass="custom-scheme-dialog">
  <form [formGroup]="addSchemeForm" (ngSubmit)="onAddScheme()" class="dialog-form">
    <div class="form-grid">
      <div class="form-field">
        <label for="schemeCode">Scheme Code</label>
        <input type="text" id="schemeCode" formControlName="code" placeholder="Enter Scheme Code" class="p-inputtext" />
        <small class="error-msg" *ngIf="addSchemeForm.get('code')?.invalid && addSchemeForm.get('code')?.touched">
          Scheme Code is required
        </small>
      </div>
      <div class="form-field">
        <label for="schemeTitle">Scheme Title</label>
        <input type="text" id="schemeTitle" formControlName="title" placeholder="Enter Scheme Title"
          class="p-inputtext" />
        <small class="error-msg" *ngIf="addSchemeForm.get('title')?.invalid && addSchemeForm.get('title')?.touched">
          Scheme Title is required
        </small>
      </div>

      <div class="form-field">
        <label>Policy Start Date</label>
        <p-datepicker formControlName="policy_start_date" (onSelect)="onStartDateChange()" [showIcon]="true"
          inputId="policyStartDate" placeholder="dd/mm/yyyy" class="small-datepicker white-text-input" appendTo="body"
          panelStyleClass="datepicker-above" dateFormat="dd/mm/yy">
        </p-datepicker>
        <small class="error-msg"
          *ngIf="addSchemeForm.get('policy_start_date')?.invalid && addSchemeForm.get('policy_start_date')?.touched">
          Start Date is required
        </small>
      </div>

      <div class="form-field">
        <label>Policy End Date</label>
        <p-datepicker formControlName="policy_end_date" [minDate]="startDate" [showIcon]="true" inputId="policyEndDate"
          placeholder="dd/mm/yyyy" class="small-datepicker white-text-input" appendTo="body"
          panelStyleClass="datepicker-above" dateFormat="dd/mm/yy">
        </p-datepicker>
        <small class="error-msg"
          *ngIf="addSchemeForm.get('policy_end_date')?.errors?.['required'] && addSchemeForm.get('policy_end_date')?.touched">
          End Date is required
        </small>
        <small class="error-msg"
          *ngIf="addSchemeForm.get('policy_end_date')?.errors?.['endBeforeStart'] && addSchemeForm.get('policy_end_date')?.touched">
          End Date cannot be before Start Date
        </small>
      </div>

      <div class="form-field card flex flex-col w-full md:w-56">
        <label for="status" class="dropdown-label">Status</label>

        <p-select [options]="statusOptions" formControlName="status" optionValue="value" optionLabel="name"
          placeholder="Select Status" class="professional-dropdown" appendTo="body" (onBlur)="statusTouched = true">
        </p-select>

        <small class="text-danger" *ngIf="addSchemeForm.get('status')?.invalid && statusTouched">
          Status is required
        </small>
      </div>


    </div>

    <p-footer>
      <div class="footer-actions">
        <button pButton type="button" label="Cancel" class="p-button-text cancel-btn"
          (click)="showAddSchemeDialog = false"></button>
        <button pButton type="submit" [label]="isEditMode ? 'Update' : 'Save'" class="save-btn"
          [disabled]="addSchemeForm.invalid">
        </button>
      </div>
    </p-footer>
  </form>

</p-dialog>
<p-dialog header="Add Eligibility/Claim" [(visible)]="showAddProformaDialog" [modal]="true" [style]="{width: '560px'}">
  <form [formGroup]="addProformaForm" (ngSubmit)="onAddProforma()">
    <div class="p-fluid">
      <div class="p-field">
        <label>Code</label>
        <input pInputText formControlName="code" />
      </div>
      <div class="p-field">
        <label>Title</label>
        <input pInputText formControlName="title" />
      </div>
    </div>
    <p-footer>
      <button pButton type="button" label="Cancel" class="p-button-text"
        (click)="showAddProformaDialog = false"></button>
      <button pButton type="submit" label="Save" [disabled]="addProformaForm.invalid"></button>
    </p-footer>
  </form>
</p-dialog>

<p-dialog header="Scheme Details" [(visible)]="showSchemeDetailsDialog" [modal]="true" [draggable]="false" [resizable]="false" [closable]="true" [dismissableMask]="true" [style]="{ width: '620px', maxWidth: '95vw' }"
styleClass="scheme-details-dialog animate__animated animate__fadeInDown">
  <div *ngIf="selectedScheme" class="scheme-details-container">
    <div class="scheme-header">
      <i class="pi pi-briefcase scheme-icon"></i>
      <h2>{{ selectedScheme.title || 'Scheme Information' }}</h2>
      <p class="scheme-code">Code: {{ selectedScheme.code || 'N/A' }}</p>
    </div>
<div class="scheme-details-grid">
  <div class="detail-item" *ngFor="let field of [
              { icon: 'pi-hashtag', label: 'Scheme ID', value: selectedScheme.id },
              { icon: 'pi-calendar-plus', label: 'Policy Start Date', value: (selectedScheme.policy_start_date | date:'dd MMM yyyy') },
              { icon: 'pi-calendar-minus', label: 'Policy End Date', value: (selectedScheme.policy_end_date | date:'dd MMM yyyy') },
              { icon: 'pi-clock', label: 'Created At', value: (selectedScheme.created_at | date:'dd MMM yyyy, hh:mm a') },
              { icon: 'pi-refresh', label: 'Updated At', value: (selectedScheme.updated_at | date:'dd MMM yyyy, hh:mm a') }
            ]">
    <i class="pi {{ field.icon }}"></i>
    <div class="detail-text">
      <label>{{ field.label }}</label>
      <span>{{ field.value || 'â€”' }}</span>
    </div>
    </div>

    <div class="detail-item status">
      <i class="pi pi-check-circle"></i>
      <div class="detail-text">
      <label>Status</label>
      <span [ngClass]="{
        'status-active': selectedScheme.status === 1 || selectedScheme.status === true,
        'status-inactive': selectedScheme.status === 0 || selectedScheme.status === false,
        'status-draft': selectedScheme.status === 2
      }">
        {{ selectedScheme.status === 1 || selectedScheme.status === true ? 'Active'
        : selectedScheme.status === 0 || selectedScheme.status === false ? 'Inactive'
        : 'Draft' }}
      </span>
    </div>
 </div>
    </div>

  </div>

  <p-footer>
    <button pButton label="Close" icon="pi pi-times" class="p-button-rounded p-button-secondary close-btn" (click)="showSchemeDetailsDialog = false"></button>
  </p-footer>
</p-dialog>